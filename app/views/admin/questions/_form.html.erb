<div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
  <%= form_with model: [:admin, @quiz, @question], local: true, class: "p-8" do |f| %>
    <div class="space-y-8">

      <div class="space-y-2">
        <%= f.label :question_text, class: "block text-sm font-semibold text-slate-700" do %>
          Question Text
          <span class="text-red-500">*</span>
        <% end %>
        <%= f.text_area :question_text, rows: 4, class: "w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none text-slate-900",placeholder: "Enter your question here...", required: true %>
      </div>

      <div class="space-y-2">
        <%= f.label :question_type, class: "block text-sm font-semibold text-slate-700" do %>
          Question Type
          <span class="text-red-500">*</span>
        <% end %>
        <%= f.select :question_type, Question.question_types.keys.map { |k| [k.humanize, k] }, { include_blank: "Select Question Type" }, class: "w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-slate-900 bg-white cursor-pointer", id: "question_type", required: true %>
      </div>

      <div id="mcq-options" class="<%= @question.mcq? ? '' : 'hidden' %> space-y-4">
        <div class="flex items-center justify-between">
          <label class="block text-sm font-semibold text-slate-700">
            Answer Options
            <span class="text-red-500">*</span>
          </label>
          <span class="text-xs text-slate-500">Select the correct answer</span>
        </div>

        <div id="options-container" class="space-y-3">
          <%= f.fields_for :options do |of| %>
            <div class="flex items-start gap-3 p-4 bg-slate-50 rounded-lg border border-slate-200 hover:border-indigo-300 transition-all option-row">
              <%= of.hidden_field :id if of.object.persisted? %>

              <div class="flex items-center pt-2">
                <input type="radio" name="correct_option_temp" value="<%= of.index %>" <%= "checked" if @question.correct_option_id == of.object.id %> class="w-5 h-5 text-indigo-600 border-slate-300 focus:ring-2 focus:ring-indigo-500 cursor-pointer" />
              </div>

              <%= of.text_field :content, class: "flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-slate-900", placeholder: "Enter option text..." %>

              <button type="button"  class="remove-option mt-1 p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all" title="Remove option">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>

              <%= of.hidden_field :_destroy, class: "destroy-flag" %>
            </div>
          <% end %>
        </div>

        <button type="button" id="add-option" class="inline-flex items-center px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-all">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Add Option
        </button>
      </div>

      <!-- True/False Info -->
      <div id="tf-info" class="<%= @question.true_false? ? '' : 'hidden' %> p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <p class="text-sm font-medium text-blue-900">True/False Question</p>
            <p class="text-sm text-blue-700 mt-1">This question will automatically have <strong>True</strong> and <strong>False</strong> as answer options.</p>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="flex items-center justify-end gap-3 pt-6 border-t border-slate-200">
        <%= link_to "Cancel", admin_quiz_questions_path(@quiz), class: "px-6 py-3 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-all" %>
        <%= f.submit "Save Question", class: "px-6 py-3 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-indigo-700 rounded-lg hover:from-indigo-700 hover:to-indigo-800 shadow-lg hover:shadow-xl transition-all cursor-pointer" %>
      </div>

    </div>
  <% end %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const optionsContainer = document.getElementById("options-container");
    const addOptionBtn = document.getElementById("add-option");
    const typeSelect = document.getElementById("question_type");
    const mcqOptions = document.getElementById("mcq-options");
    const tfInfo = document.getElementById("tf-info");

    addOptionBtn?.addEventListener("click", () => {
      const index = Date.now();
      const template = `
        <div class="flex items-start gap-3 p-4 bg-slate-50 rounded-lg border border-slate-200 hover:border-indigo-300 transition-all option-row">
          <div class="flex items-center pt-2">
            <input 
              type="radio" 
              name="correct_option_temp" 
              value="${index}"
              class="w-5 h-5 text-indigo-600 border-slate-300 focus:ring-2 focus:ring-indigo-500 cursor-pointer" />
          </div>
          <input 
            type="text" 
            name="question[options_attributes][${index}][content]" 
            class="flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-slate-900" 
            placeholder="Enter option text..." />
          <button 
            type="button" 
            class="remove-option mt-1 p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all"
            title="Remove option">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
          <input 
            type="hidden" 
            name="question[options_attributes][${index}][_destroy]" 
            value="false" 
            class="destroy-flag" />
        </div>`;
      optionsContainer.insertAdjacentHTML("beforeend", template);
    });

    optionsContainer?.addEventListener("click", (e) => {
      const removeBtn = e.target.closest(".remove-option");
      if (removeBtn) {
        const row = removeBtn.closest(".option-row");
        const destroyField = row.querySelector(".destroy-flag");
        if (destroyField) { 
          destroyField.value = "1"; 
          row.classList.add("hidden"); 
        } else { 
          row.remove(); 
        }
      }
    });

    typeSelect?.addEventListener("change", () => {
      mcqOptions.classList.add("hidden");
      tfInfo.classList.add("hidden");
      if (typeSelect.value === "mcq") mcqOptions.classList.remove("hidden");
      if (typeSelect.value === "true_false") tfInfo.classList.remove("hidden");
    });
  });
</script>
